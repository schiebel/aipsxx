<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
  <head>
    <title>September 1999 News</title>
  </head>

 
<BODY BACKGROUND="side_bar.gif" BGCOLOR="#FFFFFF" TEXT="#000000"
LINK="#C82828" VLINK="#C82828">

<TABLE CELLPADDING=0 CELLSPACING=0 BORDER=2 WIDTH="250">
<TR>
<TH BGCOLOR="#FFD600"><FONT FACE=helvetica>AIPS++ Site</b></FONT></TH>
<TH BGCOLOR="#FFD600"><FONT FACE=helvetica><b>Nov-Mar</b></FONT></TH>
<TH BGCOLOR="#FFD600"><FONT FACE=helvetica><b>Apr-Oct</b></FONT></TH></TR>

<TR><TD BGCOLOR="00009c">
<FONT FACE=HELVETICA COLOR="#FFFFFF">
<A HREF="http://www.atnf.csiro.au/"<B>New South Wales</A></B></FONT>
</TD><TD BGCOLOR="#00009c">
<FONT FACE=HELVETICA COLOR="#FFFFFF">+11:00</FONT></TD>
<TD BGCOLOR="#00009c">
<FONT FACE=HELVETICA COLOR="#FFFFFF">+10:00</FONT></TD>
</TR>
<TR><TD BGCOLOR="#3300ff">
<FONT COLOR="#FFFFFF" FACE=HELVETICA>
<B><A HREF="http://www.nfra.nl">Netherlands</A></B></FONT></TD>
<TD BGCOLOR="#3300ff">
<FONT FACE=HELVETICA COLOR="#FFFFFF">+01:00</FONT></TD>
<TD BGCOLOR="#3300ff">
<FONT FACE=HELVETICA COLOR="#FFFFFF">+02:00</FONT></TD>
</TR>
<TR><TD BGCOLOR="#0066ff">
<FONT FACE=HELVETICA COLOR="#FFFFFF">
<B>Universal Time</B></FONT>
</TD><TD BGCOLOR="#0066ff">
<FONT FACE=HELVETICA COLOR="#FFFFFF"> 00:00</FONT></TD>
<TD BGCOLOR="#0066ff">
<FONT FACE=HELVETICA COLOR="#FFFFFF"> 00:00</FONT></TD>
</TR>
<TR><TD BGCOLOR="#61B6FF">
<FONT FACE=HELVETICA COLOR="#000000">
<B><A HREF="http://www.cv.nrao.edu/">Virginia</A></B></FONT></TD>
<TD BGCOLOR="#61B6FF">
<FONT FACE=HELVETICA COLOR="#000000">-05:00</FONT></TD>
<TD BGCOLOR="#61B6FF">
<FONT FACE=HELVETICA COLOR="#000000">-04:00</FONT></TD>

</TR>
<TR><TD BGCOLOR="#BDE7FF">
<FONT FACE=HELVETICA COLOR="#000000">
<B><A HREF="http://monet.astro.uiuc.edu/">Illinois</A></B></FONT></TD>

<TD BGCOLOR="#BDE7FF">
<FONT FACE=HELVETICA COLOR="#000000">
-06:00</FONT></TD>
<TD BGCOLOR="#BDE7FF">
<FONT FACE=HELVETICA COLOR="#000000">
-05:00</FONT></TD></TR>
<TR><TD BGCOLOR="#D1F4FF">
<FONT FACE=HELVETICA COLOR="#000000">
<B><A HREF="http://www.aoc.nrao.edu/">New Mexico</A></B></FONT>
</TD>
<TD BGCOLOR="#D1F4FF">
<FONT FACE=HELVETICA COLOR="#000000">-07:00
</FONT></TD>
<TD BGCOLOR="#D1F4FF">
<FONT FACE=HELVETICA COLOR="#000000">-06:00
</FONT></TD></TR>
</TABLE>

<TABLE CELLPADDING=16  CELLSPACING=8  BORDER=0 WIDTH="100%">
<TR><TD>

</TD><TD>
<IMG SRC="aips_logo9_13.gif">
<P>
<FONT FACE=HELVETICA SIZE="3" COLOR="#000088"><B>
September 1999<BR>
</B>
</FONT>
</TD></TR>

<TR><TD VALIGN=TOP>
<FONT FACE=HELVETICA COLOR="#FFFFFF">
Table of Contents:
<P>
<A HREF="#viewer"><FONT COLOR="#FFFFFF">
The <FONT FACE=HELVETICA>AIPS++</FONT><BR>
Viewer</A></FONT><P>

<A HREF="#tables"><FONT COLOR="#FFFFFF">
Accessing <BR> 
<FONT FACE=HELVETICA>AIPS++</FONT><BR>
Tables <BR> from <I>Glish</I></A></FONT>
<P>
<A HREF="#summary"><FONT COLOR="#FFFFFF">
Project New Summary</A></FONT><P>

<A HREF="#imaging"><FONT COLOR="#FFFFFF">
Wide-Field Imaging<BR>in <FONT FACE=HELVETICA>AIPS++</FONT></A></FONT>
<P>
<A HREF="#new"><FONT COLOR="#FFFFFF">
What's New</A></FONT><P>




</TD><TD VALIGN=TOP>
<A NAME="viewer"><FONT FACE="helvetica" SIZE="+2"><B>
The AIPS++ </B></FONT>
<FONT FACE="COURIER" SIZE="+2"><B>Viewer</B></FONT></A>
<FONT FACE="helvetica" SIZE="+2"><B>
 and </B></FONT>
<FONT FACE="COURIER" SIZE="+2">
<B>ImageFitter</B></FONT> 
<FONT FACE="helvetica" SIZE="+2"><B>
Tools</B></FONT><BR>
<I>Neil Killeen and David Barnes, </I>ATNF, Epping<P>

<P>In this article, we introduce the <FONT FACE="HELVETICA"><B>AIPS++</B></FONT> 
  <FONT FACE="COURIER">Viewer</FONT> and <FONT FACE="COURIER">Imagefitter</FONT> tools. 
The <FONT FACE="COURIER">Viewer</FONT>  is the first tool which was built with the 
 <FONT FACE="HELVETICA"><B>AIPS++</B></FONT> 
<FONT FACE="COURIER">Display Library</FONT>, which was introduced in the 
<A HREF="../../../docs/newsletters/mar98/marchnews/marchnews.html">March</A>
and <A HREF="../../../docs/newsletters/nov98/octnews/octnews.html">November 1998</A>  
 <FONT FACE="HELVETICA"><B>AIPS++</B></FONT> Newsletters. 
It provides flexible display and hardcopy services for <FONT FACE="COURIER">Images</FONT> and 
<I>Glish</I> arrays. The <FONT FACE="COURIER">Imagefitter</FONT> is another new 
<FONT FACE="HELVETICA"><B>AIPS++</B></FONT> tool which provides an innovative, interactive approach 
to fitting various components to image-plane sources. It uses some of the advanced 
<FONT FACE="COURIER">Viewer</FONT> services to get input from the user.<P>

<FONT FACE=helvetica SIZE="+1"><B>The Viewer</B></FONT><BR>
The <FONT FACE="COURIER">Viewer </FONT> has grown from the low-level agents 
described in the November 1998 
<FONT FACE="HELVETICA"><B>AIPS++</B></FONT> Newsletter, to a tool which can be used to produce raster and contour displays of  Images and <I>Glish</I> Arrays.</P>
<P>Highlights of <FONT FACE="COURIER">Viewer</FONT> include:</P>

<UL>
<LI>accurate, color-coded, non-linear axis labeling; </LI>
<LI>formatted position and data value reporting; </LI>
<LI>interactive region definition; </LI>
<LI>high-quality PostScript output, with adjustable resolution; </LI>
<LI>direct bitmap output; </LI>
<LI>operable completely from a Graphical User Interface or from the Command Line window and </LI>
<LI>multiple Display Panels with user control over color allocation</LI></UL>

<P>You can start  the <FONT FACE="COURIER">Viewer</FONT>  from either the 
Tool Manager GUI or from the Command Line window. For example, <P>

<FONT FACE="COURIER">include 'viewer.g'<BR>
dv.gui()</FONT>
<P>

<P>at which point two new GUIs appear on the screen, entitled 
Data Manager and Display Panel. In the example shown below, we first clicked on 
<B>Raster Image</B> under <I>Display Type</I>, and then on
<B>"image:ccg1\_v.rot.im"</B> producing a tool which draws a rastered view of this optical image. This added
 the entry <B>"image:ccg1\_v.rot.im(Raster Image:1)"</B> to the 
<I>Adjust Data</I> list. We then selected <B>Contour</B> followed by <B>"image:ccg1\_m0.im"</B> producing a 
tool to draw contours of this HI moment map. Then we simply selected <B>Register All</B> 
from the <I>Display Data</I> menu of the 
Display Panel GUI,  and an overlay of the 
HI contours on the optical image was generated. Clicking 
<FONT FACE="HELVETICA">Adjust</FONT> in the 
bottom left corner of the Display Panel GUI allows us to select a new 
<B>colormap</B> for the optical image, and add axis labels to the image. 
Note the two positions listed below the display and above the buttons: the upper one shows the value and position of the cursor 
on the optical image; and the second shows the value and position of the cursor on the moment map. The moment map has an 
additional axis (frequency), so the value along that axis is also displayed.
<P>
<P><IMG SRC="viewer3.gif"><P>
<P>An alternative to the <FONT FACE="COURIER">Viewer</FONT>
tool interface is to construct an 
<FONT FACE="HELVETICA"><B>AIPS++</B></FONT>  <FONT FACE="COURIER">Image</FONT>   tool, and then use its 
<FONT FACE="COURIER">view</FONT> tool function to display the image. 
For example, <P>
<FONT FACE="COURIER"><P>include 'image.g'<BR>
im := image('hcn.m0')<BR>
im.view()</FONT>
<P>brings  up a Display Panel GUI with a raster display of the image as shown below - 
after you have  also designated a polygonal region and worked out some statistics.
<P>
<CENTER>
<IMG SRC="imageview3.gif">
</CENTER>
<P>
<FONT FACE="HELVETICA" SIZE="+1"><B>The Imagefitter</B></FONT>

<BR>The <FONT FACE="COURIER">Imagefitter</FONT> is an interactive tool 
that provides facilities for 
2-dimensional models to regions of the sky. This tool is written as a <I>Glish</I> script using 
services provided by a range of 
other <FONT FACE="HELVETICA"><B>AIPS++</B></FONT> components. 
One of the most interesting 
things about the 
<FONT FACE="COURIER">Imagefitter</FONT> is that anyone with some <I>Glish</I>
 programming skills can write  it. </P>
<P>The <FONT FACE="COURIER">Imagefitter</FONT> uses the following 
<FONT FACE="HELVETICA"><B>AIPS++</B></FONT> 
components<P>

<UL>
<LI>Basic <I>Glish</I> and <I>Glish</I>/<FONT FACE="COURIER">Tk</FONT> 
capabilities; </LI>
<LI>The <FONT FACE="COURIER">Pgplotwidget</FONT>  tool which provides 
some line graphics capabilities; </LI>
<LI>The <FONT FACE="COURIER">Image</FONT>  tool which provides the 
actual fitting of the model to the image and some pixel value access; </LI>
<LI>The <FONT FACE="COURIER">Regionmanager </FONT> tool which is used 
to manipulate image regions of interest; </LI>
<LI>The <FONT FACE="COURIER">Componentlist</FONT> tool  to store and pass around the fitted components; and </LI>
<LI>The <FONT FACE="COURIER">Viewer</FONT>  which provides the image display capabilities. Before the 
<FONT FACE="COURIER">Viewer</FONT> was available, the 
<FONT FACE="COURIER">Imagefitter</FONT>
display was done with <FONT FACE="COURIER">Pgplotwidget</FONT>. 
This component was easily replaced when the 
<FONT FACE="COURIER">Viewer</FONT> became available, 
bringing with its functionality. </LI></UL>

<P>You can start the <FONT FACE="COURIER">Imagefitter</FONT>  from either the 
Tool Manager GUI or from the Command Line window<P>

<FONT FACE="COURIER"><P>include 'imagefitter.g'<BR>
imf := imagefitter(infile='hcn.m0', modify=T)</FONT># Subtract models directly<BR>
<FONT FACE="COURIER">cl := imf.componentlist()</FONT># 
Recover component list when finished</P>
<P>where <B>'hcn.m0' </B> is the name of an <FONT FACE="HELVETICA"><B>AIPS++</B></FONT> image file (
you could also supply the argument <FONT FACE="COURIER">infile</FONT> to 
<FONT FACE="COURIER">image</FONT> tool, viz, <P>

<FONT FACE="COURIER">im := image('hcn.m0')</FONT>). 

<P>
With the Imagefitter you can subtract the model from the image 
as you proceed. 
By default, a copy of the input image is made and that is the image from which the subtraction is done. 
You subtract
 from the input image with argument the 
<P><FONT FACE="COURIER">modify=T</FONT>
<P>
(as in the example above). Issuing the above command brings up a GUI as shown in the following figure 
(where we have performed some extra steps, as discussed below).
<P>
<A HREF="imagefitter2.gif"><IMG SRC="imagefitter3.gif"></A><BR>

<P>This GUI shows a display of the image to the right. Beneath the image is a 
<FONT FACE="HELVETICA">listbox</FONT> 
showing the parameters of the model fits. To the left are the ranges for the residuals of the fits. 
At the top is a histogram and some 
statistics. Below that is an image of the residuals in the fitted region. 

<P>A rollup window beneath the data displays (labeled <FONT FACE="HELVETICA">Fitting Control</FONT>) 
gives you selection of types (<B>gaussian</B>, 
<B>point</B>, 
and <B>disk</B> - currently only <B>gaussian</B> 
is implemented) of models (menu labeled <I>Types</I>), control over which parameters of the model are fixed and 
which are solved for (menu <I>Fixed</I>), whether you subtract the model from the image 
or not (check box <FONT FACE="HELVETICA">Subtract</FONT>) and control over the pixel ranges 
included in the fitting 
process (panel <FONT FACE="HELVETICA">Pixel Range</FONT>). 

<P>Finally, a message line below the rollup window provides information on what to do next. 
The <FONT FACE="COURIER">Imagefitter</FONT> constrains 
you as much as it can so that the only things you can do are valid!


<P>In this example in the Figure, we have marked a box region on the image. This is done by 
clicking  your left mouse button
on the box region icon of the control box to the left of the main image display. After dragging out the region, a double click of the button inside 
the region signifies that the region is ready. The fit of the selected model (a <B>gaussian</B>) 
is done, the residuals are displayed, and the parameters are written into the scrolling list box.

<P>At this point, you may press the <FONT FACE="HELVETICA">accept</FONT> or 
<FONT FACE="HELVETICA">reject</FONT> button  to signify whether 
or not you are happy with the fit. If you accept 
the fit, and the <FONT FACE="HELVETICA">Subtract</FONT> box is checked, 
then the fit is subtracted from the main 
display. You can then create another region and do another fit.</P>

<P>When you accept a fit, an internal list is kept of the model fits. These are stored in a standard 
<FONT FACE="HELVETICA"><B>AIPS++</B></FONT> <FONT FACE="COURIER">Componentlist</FONT> tool 
which can  be recovered from the <FONT FACE="COURIER">Imagefitter</FONT> tool at any time. 
They can be used with the synthesis 
imaging tools for specifying source component models. 

<P>Also, when you accept a fit the region for which the fit was generated is also stored in an internal list. Under the 
<I>File</I> menu at the top left of the GUI are items that enable you to delete regions 
from that list if you desire, or save those regions to an <FONT FACE="HELVETICA"><B>AIPS++</B></FONT> Table.
For example, because <FONT FACE="HELVETICA"><B>AIPS++</B></FONT>
images are themselves Tables, you can 
store the regions in the image with which you performed the fits. You can also recover these regions from 
a table and automatically fit them.</P>

<P>Also under the <I>File</I> menu is an item that allows you to store the 
<FONT FACE="COURIER">Componentlist</FONT> as a 
<FONT FACE="COURIER">Table</FONT>. 
In this way you can permanently store component lists.

<P>Future enhancements to <FONT FACE="COURIER">Imagefitter</FONT> will include the following.</P>

<UL>
<LI>Multiple simultaneous models. Currently you can only fit one 
<B>gaussian</B> model at a time. </LI>
<LI>Interactive specification of starting model guesses. Currently, the starting guess for each model is automatically determined - 
when you are holding parameters in a fit fixed, you really want to be able to specify those parameters. 
In the Command Line window  interface 
to the fitting function of the <FONT FACE="COURIER">Image</FONT>  tool 
(used by the <FONT FACE="COURIER">Imagefitter</FONT>) it is possible to make this specification. 
The GUI needs to be extended 
to incorporate this. </LI>
<LI>An automatic mode where sources are found and fitted.</UL>

</TD></TR>

<TR><TD VALIGN=TOP>
<FONT FACE=HELVETICA>
<A HREF="#viewer"><FONT COLOR="#FFFFFF">
The <FONT FACE=HELVETICA>AIPS++</FONT><BR>
Viewer</A></FONT><P>

<A HREF="#tables"><FONT COLOR="#FFFFFF">
Accessing <BR> <FONT FACE=HELVETICA>AIPS++</FONT><BR>
Tables from <BR><I>Glish</I></A></FONT>
<P>
<A HREF="#summary"><FONT COLOR="#FFFFFF">
Project New Summary</A></FONT><P>

<A HREF="#imaging"><FONT COLOR="#FFFFFF">
Wide-Field Imaging <BR>in <FONT FACE=HELVETICA>AIPS++</FONT></A></FONT>
<P>
<A HREF="#new"><FONT COLOR="#FFFFFF">
What's New</A></FONT><P>
</B></FONT>



</TD><TD VALIGN=TOP>

<A NAME="tables"><FONT FACE="HELVETICA" SIZE="+2"><B>Accessing <B>AIPS++</B> Tables from Glish</B></FONT></A><BR>
<I>Ger van Diepen</I>, NFRA, Dwingeloo <P>
<FONT FACE="HELVETICA" SIZE="+1">Introduction</FONT>

<P>
Tables are the main storage mechanism for <FONT FACE="Helvetica"><B>AIPS++</B></FONT> data. 
The concepts of <FONT FACE="Helvetica"><B>AIPS++</B></FONT> Tables are discussed in an 
article in the <FONT FACE="Helvetica"><B>AIPS++</B></FONT> Newsletter of 
<A HREF="../../../docs/newsletters/nov98/octnews/octnews.html">November 1998</A>. This article discusses how an 
<FONT FACE="Helvetica"><B>AIPS++</B></FONT> Table can be accessed from the <I>Glish</I> level. 
It is assumed that you are  familiar with the Table concept and with the syntax of <I>Glish</I>. 


<P>
The <FONT FACE="COURIER">Table</FONT> tool makes it possible to access a 
Table. This tool is defined in the script file <FONT FACE="COURIER">table.g</FONT>. 
It has functions which make  it possible to open or create a Table, get or put data, query the 
Table, or browse the Table. Each of these topics are described in detail in the help information; 
in this article  only the most important functions are discussed. 

<P>
<FONT FACE=HELVETICA SIZE="+1">Investigating a Table</FONT>
<BR>
An easy way in which you  can explore the structure or the contents of a Table such as an
<FONT FACE="Helvetica"><B>AIPS++</B></FONT> Measurement Set is by using 
the <FONT FACE="COURIER">summary</FONT> function. 
Browse through the Table by typing the following at the Command Line window.</P>
<PRE>
 include 'table.g'
 t := table ('9903770.MS');    # open the table
 t.summary();
 t.browse();
 t.close();</PRE>
<P>
In order to keep memory usage down, you should close a Table when it is 
not needed anymore. It may also reduce file locking overhead when the same Table is 
used in another process. 

<P>
The Table Browser  GUI is a very powerful tool. It is possible to view the contents of keywords 
and columns, to browse through a sub-Table, or to select a subset of the Table.  The only 
disadvantage is that it can be slow for larger Tables. 

You can browse through a subset of data by using the <FONT FACE="COURIER">
query</FONT> function and typing the following on the Command Line window:

<PRE>
 t := table ('9903770.MS');
 t1 := t.query ('ANTENNA1==1 &amp;&amp; ANTENNA2==3');
 t.close();
 t1.browse();
 t1.close();</PRE>
<P>The <FONT FACE="COURIER">query</FONT> function creates a 
subset of the Table by selecting the rows 
matching the given criteria. The resulting subset is a Table in itself.  The 
<FONT FACE="COURIER">query</FONT>  function 
is very powerful.. It is based on the Table Query Language (TaQL) described in 
<A HREF="../../../docs/notes/199/199.html">Note 199</A>. The <FONT FACE="COURIER">query</FONT> function has string 
arguments for the various parts of a  TaQL expression: </P>

<UL>
<LI>the first argument (<FONT FACE="COURIER">query</FONT>) gives the WHERE part; </LI>
<LI>the <FONT FACE="COURIER">sortlist</FONT> argument gives the ORDERBY part;</LI>
<LI>the <FONT FACE="COURIER">name</FONT> argument gives the GIVING part; and</LI>
<LI>the <FONT FACE="COURIER">columns</FONT> argument gives the SELECT part. </LI></UL>

<P>Viewing all baselines in a Measurement Set can be done by typing the 
following in the Command Line window: </P>
<PRE>
 t := table ('9903770.MS');
 t1 := t.query (sortlist='NODUPLICATES ANTENNA1, ANTENNA2');
 t1.browse();
 t.close();
 t1.close();</PRE>
<P>Here the <FONT FACE="COURIER">query</FONT> function only executes a sort on the Table 
while skipping all duplicates. This  results in all baselines being used in the Measurement Set. 

<P>
<FONT FACE=HELVETICA SIZE="+1"><B>Fixing incorrect data in a Table</B></FONT>
<BR>
In the SYSCAL sub-Table of some Westerbork Measurement Sets, the ANTENNA_ID of 
antenna 7 was stored as 0 instead of 7. A possible fix is shown below. It also checks if the 
data are as expected. 
<P>
<PRE>
 t := table ('9903770.MS');
 ta := table (t.getkeyword ("SYSCAL"), readonly=F);   # 1
 t.close();                                           # 2
 ta1 := ta.query ('ANTENNA_ID==0');                   # 3
 ta.close();
 ta2 := ta1.query (sortlist='NODUPLICATES TIME');     # 4
 nrow := ta2.nrows();
 ta2.close();                                         # 5
 if (ta1.nrows() != 2*nrow) {                         # 6
   ta1.close();
   fail 'Incorrect antennas';                      
 }
 ta2 := ta1.query ('rownumber()%2 == 0');             # 7
 vec := array(7, nrow);                               # 8
 ta2.putcol ('ANTENNA_ID', vec);
 ta2.close();                                         # 9
 ta1.close();</PRE>
<OL>

<LI>The name of the SYSCAL Table is stored in the SYSCAL keyword of the Measurement Set. 
You can get the keyword value and open that Table as read/write. </LI>
<LI>The main Measurement Set Table is not needed anymore, thus close it. </LI>
<LI>Create the subset containing all antennas 0. Close the SYSCAL Table,  as you 
do not need it anymore. </LI>
<LI>Each timestamp should have 2 rows: one correct row for antenna 0 and one incorrect row 
for antenna 7. By sorting on time and skipping duplicate entries, you should get half the number 
of rows. </LI>
<LI>The Table is immediately closed, in case the next step fails. </LI>
<LI>Check if you indeed get half the number of rows. If not, exit with a fail status. Of course, 
do not forget to close the open Tables before exiting. </LI>
<LI>Every second row in your subset is incorrect (antenna 0 always preceeds antenna 7), so 
select those rows. Note that row number indexing conforms <I>Glish</I> indexing, thus it is 1-relative. 
</LI>
<LI>Create a vector with the length of the subset and fill it with 7. Put that vector into the 
column. Another possibility is <BR>
<PRE>
ta2.putcol ('ANTENNA_ID', 7 + ta2.getcol ('ANTENNA_ID'))
</PRE> <BR>
which works because the current contents are 0. </LI>
<LI>Close all open Tables and you are done. </LI></OL>

<P>You can be a bit smarter by using the striding possibilities of 
<FONT FACE="COURIER">putcol</FONT> and replacing Step 7 and 
8 with: </P>
<PRE>
 vec := array(7, nrow);
 ta1.putcol ('ANTENNA_ID', vec, rowincr=2);
</PRE>
<P>
This  saves the extra selection step and is probably not less clear. </P>
<P>Another problem in a Measurement Set could be that the sign of the XY polarization is
 incorrect.  Assume that XY is the second out of 4 polarizations. A simple approach is: 
<P>
<PRE>
 t := table ('9903770.MS', readonly=F);
 a := t.getcol ('DATA');
 if (shape(a)[1] != 4) {
   fail 'Measurement set has no 4 polarizations';
 }
 a[2,,] := -a[2,,];
 t.putcol ('DATA', a);
 t.close();</PRE>
<P>It has a few drawbacks. </P>

<UL>
<LI>The worst is that it reads the entire column, and for a larger Measurement Set it 
can be hundreds of megabytes, more than fits in virtual memory. </LI>
<LI>The second drawback is that it assumes that all data have 4 polarizations. It can well be 
that some spectral windows have less. </LI>
<LI>All polarizations are always read and written, thus more data than needed are read and 
written. </LI></UL>

<P>
A solution to the first two problems is to step through the data in such a way that each step 
is small and has the same number of polarizations. This can be achieved with 
the <FONT FACE="COURIER">tableiterator</FONT> function. The last problem 
can be solved by using the slicing variants 
of <FONT FACE="COURIER">getcol</FONT> and 
<FONT FACE="COURIER">putcol</FONT>. <P>


<PRE>
 t := table ('9903770.MS', readonly=F);
 iter := tableiterator (t, "SPECTRAL_WINDOW_ID TIME");   # 1
 while (iter.next()) {                                   # 2
   t1 := iter.table();                                   # 3
   a := t1.getcell ('DATA', 1);                          # 4
   if (shape(a)[1] == 4) {
     a := t1.getcolslice ('DATA', [2,1], [2,-1]);        # 5
     t1.putcolslice ('DATA', -a, [2,1], [2,-1]);         # 6
   }
 }
 iter.terminate();                                       # 7
 t.close();</PRE>
<P>
<OL>

<LI>An iterator is created for the Table. It iterates based on the contents of the two given columns. 
It does a temporary sort of the Table to make equal values appear adjacent. </LI>
<LI>Perform an <FONT FACE="COURIER">iteration</FONT> step until the end. Each step assembles the rows for which the given 
columns have equal values. </LI>
<LI>Get the Table containing these rows. Since this Table contains only one spectral window 
and one time stamp, the Table is not too large and all rows have the same 
number of polarizations. </LI>
<LI>Get the data from the first row to confirm  that you have 4 polarizations. If so, change the 
XY data. </LI>
<LI>Read only the XY data (which is the second polarizarion channel).  Specify 
the begin and end of each dimension, where -1 means till the end. Remember that each row in 
a Measurement Set contains a data matrix with axes polarization and frequency. </LI>
<LI>Write the reversed data back in a similar way. </LI>
<LI>Terminate the iterator, which also closes the Table used by the iterator. </LI></OL>

<FONT FACE=HELVETICA SIZE="+1"><B>Further possibilities</B></FONT><BR>
In our discussion above only a few functions have been shown. Many more exist: </P>

<UL>
<LI>Creating a Table description and a new Table. </LI>
<LI>Creating a Table from an ASCII file or writing a table to an ASCII file. </LI>
<LI>Handling an entire row as one entity. </LI>
<LI>Controlling the Table locking and synchronization mechanism. The default mechanism can 
handle simultaneous access from multiple processes, but finer control is possible. </LI>
<LI>Copying, renaming, deleting Tables. </LI></UL>

<P>A detailed description of all functions can be found in the help info of the 
<FONT FACE="COURIER">Table</FONT>  tool. 

</TD></TR>
<TR><TD VALIGN=TOP>
<FONT FACE=HELVETICA>
<A HREF="#viewer"><FONT COLOR="#FFFFFF">
The <FONT FACE=HELVETICA>AIPS++</FONT><BR>
Viewer</A></FONT><P>

<A HREF="#tables"><FONT COLOR="#FFFFFF">
Accessing <BR><FONT FACE=HELVETICA>AIPS++</FONT><BR>
Tables from <BR><I>Glish</I></A></FONT>
<P>
<A HREF="#summary"><FONT COLOR="#FFFFFF">
Project New Summary</A></FONT><P>

<A HREF="#imaging"><FONT COLOR="#FFFFFF">
Wide-Field Imaging<BR>in <FONT FACE=HELVETICA>AIPS++</FONT></A></FONT>
<P>
<A HREF="#new"><FONT COLOR="#FFFFFF">
What's New</A></FONT><P>
</FONT>






</TD>






<TD VALIGN=TOP>



<A NAME="summary"><FONT FACE="HELVETICA" SIZE="+2"><B>Project News Summary</B></FONT></A><BR>
<I>Tim Cornwell, </I>NRAO, Socorro<P>

<P>
We are nearing time for the first release of <FONT FACE="Helvetica"><B>AIPS++</B></FONT>, 
now expected in early October 1999.  Pre-release testing started in early May 1999. 
In this phase, the capabilities are frozen and we concentrate on debugging. 
We regard debugging <FONT FACE="Helvetica"><B>AIPS++</B></FONT> as the prime responsibility 
of the <FONT FACE="Helvetica"><B>AIPS++</B></FONT> Project rather than of its users. 
Consequently, over the last few months the developers have devoted the bulk of their time to  
finding and repairing problems. We have followed two main strategies: writing extensive test 
scripts, and using the package for real data reduction. This is in addition to our long-established 
practice of running <B>C++</B> test programs weekly. The figure below shows the recent 
end-of-month totals for unfixed defects of various levels of severity 
(1=catastrophic to 5=cosmetic). As you can see, the most severe defects are under the 
best control, and more minor defects (e.g. severity level 4) have grown in number as we have 
uncovered them. We are now working to fix the moderate number of minor defects.  
For perspective, the total number of defect reports submitted since the inception of 
bug tracking is approaching 2000 - so less than about 10% are currently "open."
<P>
<CENTER>
<IMG SRC="defects1.gif">
</CENTER>
<P>

During the week of August 16, 1999, the pre-release CD was shipped to our beta-testers and 
installed at the various consortium sites for intensive testing. We expect to devote approximately 
two months to this phase of testing, after which the public release will be made. Following the 
public release, the development of new capabilities will increase again and continue until the 
time of the next release, scheduled for early 2000.
<P>
<P>Since the status report in the February 1999 newsletter, 
<FONT FACE="Helvetica"><B>AIPS++</B></FONT> capabilities have changed 
substantially in only a few areas: 
<OL>
<LI>the user interface is now complete; 
<LI>the image  Viewer is now incorporated throughout the system; 
<LI>image region manipulation is now widely used; 
<LI>a VLA filler tool is now included; and 
<LI>a VLA wide-field imaging tool (<FONT FACE="COURIER">dragon</FONT>) 
is now available (see the article in this newsletter).
</OL>

</TD></TR>
<TR><TD VALIGN=TOP>
<FONT FACE=HELVETICA>
<A HREF="#viewer"><FONT COLOR="#FFFFFF">
The <FONT FACE=HELVETICA>AIPS++</FONT><BR>
Viewer</A></FONT><P>

<A HREF="#tables"><FONT COLOR="#FFFFFF">
Accessing <BR> <FONT FACE=HELVETICA>AIPS++</FONT><BR>
Tables from <I>Glish</I></A></FONT>
<P>
<A HREF="#summary"><FONT COLOR="#FFFFFF">
Project New Summary</A></FONT><P>

<A HREF="#imaging"><FONT COLOR="#FFFFFF">
Wide-Field Imaging <BR> in <FONT FACE=HELVETICA>AIPS++</FONT></A></FONT>
<P>
<A HREF="#new"><FONT COLOR="#FFFFFF">
What's New</A></FONT><P>
</FONT>




</TD><TD VALIGN=TOP>


<A NAME="imaging">
<FONT FACE="HELVETICA" SIZE="+2"><B>Wide-Field Imaging in <B>AIPS++</B></B></FONT>
</A><BR>
<I>Tim Cornwell and Kumar Golap, </I>NRAO, Socorro<P>

<P>
Aperture synthesis radio telescopes make images by Fourier inverting and deconvolving 
samples of the visibility function. This works well in most circumstances but at low frequencies, 
for some "non-coplanar" arrays (such as the VLA) the relationship between sky and visibility is 
not a two-dimensional Fourier transform. Physically this happens because the field of view is 
so large that the array shape varies as seen from different directions in the field of view. 
A number of techniques have been developed to deal with this problem. Generally  these divide 
the image plane into patches which are small enough that the Fourier transform relationship is a 
good approximation. The patches are then deconvolved jointly by one of a number of algorithms. 
Typically these patches are then combined into one image at the end of deconvolution, 
correcting for the different geometries of the different patches. This last step is time-consuming 
and basically a nuisance, since it prevents the user from seeing the entire image during 
processing. In <FONT FACE="HELVETICA"><B>AIPS++</B></FONT>, we have adopted an alternative 
approach, suggested by Wim Brouw and others, in which this geometrical correction is done 
during the gridding process for each patch. Thus the user can at all times see the entire image. 
This facility is available in the <FONT FACE="COURIER">imager</FONT> tool and 
can be selected by specifying a number of facets (or patches) which is greater than unity.

<P>
The following is an image of a 15 by 15 degree field of Coma made from 74 MHz VLA data using the <FONT FACE=HELVETICA><B>AIPS++</B></FONT> wide field imaging capabilities.  Most of the sources in this image are point sources; the artifacts around each source are highly reduced compared with previous imaging.</P>
<P>
<CENTER>
<IMG SRC="coma_74mhz.gif">
</CENTER>
<P>
Self-calibration is often needed as part of low-frequency imaging. Hence we have developed 
a tool called <FONT FACE="COURIER">dragon</FONT>, which jointly performs 
deconvolution and selfcalibration. The user specifies a sequence of thresholds. At each 
threshold, the deconvolution pauses and a self-calibration step is performed. Cleaning then 
resumes with the updated visibilities. This is conceptually similar to the "difference mapping" 
implemented in Martin Shepherd's 
<FONT FACE="COURIER">Difmap</FONT> program. The advantages are each of 
use and (relatively) low cost in computing.

<P>The <FONT FACE="COURIER">dragon</FONT> tool is a <I>Glish</I> script 
which uses services provided by other <FONT FACE="HELVETICA"><B>AIPS++</B></FONT> tools 
such as <FONT FACE="COURIER">imager</FONT>, 
<FONT FACE="COURIER">calibrater</FONT>, 
<FONT FACE="COURIER">componentmodels</FONT>, and 
<FONT FACE="COURIER">viewer</FONT>. It,  therefore,  is an example of the type of 
algorithm development that is made possible through programming in <I>Glish</I>. 
<FONT FACE="COURIER">dragon</FONT> will be available in the first release of 
<FONT FACE="HELVETICA"><B>AIPS++</B></FONT>. A cookbook chapter describing the use of 
<FONT FACE="COURIER">dragon</FONT> will also be available. Our next step 
will be to parallelize the algorithm to allow processing of, for example, A-configuration VLA 
data at 327MHz or B-configuration data at 74MHz. 

</TD></TR>
<TR><TD VALIGN=TOP>

<FONT FACE=HELVETICA>
<A HREF="#viewer"><FONT COLOR="#FFFFFF">
The <FONT FACE=HELVETICA>AIPS++</FONT><BR>
Viewer</A></FONT><P>

<A HREF="#tables"><FONT COLOR="#FFFFFF">
Accessing <BR><FONT FACE=HELVETICA>AIPS++</FONT><BR>
Tables <BR> from <I>Glish</I></A></FONT>
<P>
<A HREF="#summary"><FONT COLOR="#FFFFFF">
Project New Summary</A></FONT><P>

<A HREF="#imaging"><FONT COLOR="#FFFFFF">
Wide-Field Imaging <BR> in <FONT FACE=HELVETICA>AIPS++</FONT></A></FONT>
<P>
<A HREF="#new"><FONT COLOR="#FFFFFF">
What's New</A></FONT><P>
</FONT>




</TD><TD VALIGN=TOP>

<A NAME="new">
<FONT FACE="HELVETICA" SIZE="+2"><B>What's New</B></FONT></A><BR>
<I>Athol Kemball, </I>NRAO, Socorro<P>

<P>
The Graphical User Interface (GUI) for <FONT FACE="Helvetica"><B>AIPS++</B></FONT> has 
been considerably overhauled to increase ease of use and accessibility. The Tool Manager 
GUI has been improved in a number of respects, including revisions to command logging 
using a scripter, the addition of a clipboard cut-and-paste capability, and the use of specialized 
entry widgets for each input data type. Standard widgets are now being uniformly used in most 
GUI interfaces.

<P>Editing and revision of the Web-based documentation has continued, with general 
improvements in both content and layout in all areas.

<P>
A <FONT FACE="COURIER">filler</FONT> tool to create 
<FONT FACE="COURIER">Measurement Sets</FONT> from VLA data has been 
written, and is being carefully tested against the corresponding <B>Aips</B> task.  Modcomp 
data conversion routines were refined during this effort, and tape I/O support was added to the 
existing I/O classes.

<P>Several <I>Glish</I> defects have been corrected, along with other improvements. 
These include fixes for shared library use, architecture specific modifications, support for 
dynamically loadable objects, improved event handling and the removal of the older 
<FONT FACE="COURIER">Rivet</FONT> 
<FONT FACE="COURIER">Tk</FONT> binding.

<P>
Single-dish processing changes include extensive revisions to the GBT 
<FONT FACE="COURIER">MS</FONT> filler to accommodate a variety of 
back-end data, including holography data. A calculator has been added to 
<FONT FACE="COURIER">dish</FONT>, along with other general improvements. 
A molecular spectral line catalog has also been added to the system.

<P>
The sky-component fitter (<FONT FACE="COURIER">imagefitter</FONT>) has been improved (mainly the fit 
quality) and several defects corrected.   The regionmanager has been 
extended, including the addition of widgets to save and restore regions 
to and from a Table.  The Lattice Expression Language (LEL) has been 
extended, and a  <A HREF="../../../docs/notes/223/223.html">Note 223</A> describing LEL usage checked 
into the system. Mixed world/pixel coordinate conversion has been introduced 
and optimized in the coordinate classes. 
Convolution capability was introduced into the Image tool and it
now also supports image masks.


<P>

Support for parallel processing has been provided through a new version of 
<FONT FACE="COURIER">pimager.g</FONT>, including more recent changes in 
<FONT FACE="COURIER">imager.g</FONT>. Full 
<FONT FACE="COURIER">mpirun</FONT> support has been added to the system 
and the algorithm-applicator design improved. An interface to optimized FFT routines 
(SCSL library) has been added to the system.

<P>

The deconvolution tool (<FONT FACE="COURIER">deconvolver</FONT>) 
has been supplemented with MEM and Lattice-based Clark CLEAN methods, 
along with other improvements. A tool to manage antenna voltage-patterns 
(<FONT FACE="COURIER">vpmanager</FONT>) has been added to control 
the selection and setting of primary-beam corrections that can be saved in 
<FONT FACE="COURIER">tables</FONT>. Deconvolution capabilities have been 
improved in several areas, including the addition of multi-resolution CLEAN, and implementation 
of a progress meter. Support has been added for D-term polarization beam response. 
The <FONT FACE="COURIER">imager</FONT> tool consistency tests have also 
been improved. Data selection in the <FONT FACE="COURIER">calibrater</FONT> 
tool has also been improved.


<P>

A <I>Glish</I> script implementing wide-field imaging capability has been added 
(<FONT FACE="COURIER">dragon.g</FONT>), which extends the capabilities 
previously available in SDE under this name. This has included some changes in the 
multi-field and wide-field imaging infrastructure in support of this new capability.

<P>The <FONT FACE="COURIER">simulator</FONT> tool has been enhanced, 
with new methods to specify (<FONT FACE="COURIER">set</FONT>) the 
calibration components.


<P>

The Display Library (<FONT FACE="COURIER">DL</FONT>) has been extensively 
expanded with changes in color map handling, general optimization, event handling, axis 
labeling, coordinate conversion, display option handling, and the addition of a PostScript 
capability. The <FONT FACE="COURIER">viewer</FONT> tool, which is based on 
the <FONT FACE="COURIER">DL</FONT>, has been significantly enhanced.  
The <FONT FACE="COURIER">simpleimage.g</FONT> <I>Glish</I> script has 
been revised to use the <FONT FACE="COURIER">viewer</FONT>.

<P>

In the <FONT FACE="COURIER">Table</FONT> system there have been 
improvements in file locking and a reduction in the number of physical files used through 
optimization of the storage managers utilized for indirect arrays. The capability for 
column-based indexing has also been added.


<P>

The WSRT package has been revised during this period, both in data display and examination. 
Utilities for interaction with <FONT FACE="COURIER">TMS</FONT> 
(Telescope Management System) have been added. The Parkes multi-beam package has 
similarly been extended, and an initial version of the NPOI optical interferometry package has 
been added.


<P>

Notes <A HREF="../../../docs/notes/223/223.html">223</A> and 
<A HREF="../../../docs/notes/224/224.html">224</a> have been checked-in to the system, describing new fitting capabilities 
and the LEL respectively.


<P>A capability to read ASCII component lists has been added with the <I>Glish</I> script 
<FONT FACE="COURIER">ascii2complist.g</FONT>.


<P>

There have been a number of general improvements in the 
Table Browser GUI.


<P>

In the system area, there has been significant work to support the 
<FONT FACE="COURIER">DL</FONT> and shared libraries elsewhere in 
the system. Binary release capabilities have also been extended. Utility functions have been 
better separated, as can be seen in the latest User Reference Manual. The 
<FONT FACE="COURIER">askme.g</FONT> and 
<FONT FACE="COURIER">bug.g</FONT> scripts have been extended, 
and defect tracking changed from <B>GNATS</B> to <B>ClearDDTS</B>.


 <hr>
    <address><a href="mailto:kweather@nrao.edu">Kate Weatherall</a></address>
<!-- Created: Tue Sep  7 13:24:35 MDT 1999 -->
<!-- hhmts start -->
Last modified: Wed Sep 29 15:53:49 MDT 1999
<!-- hhmts end -->
 
</TD></TR>
</TABLE>
</body>
</html>   
