\setlongtables
\begin{longtable}[c]{|l|}
\caption{User Script avgscan.g}\label{avgscan} \\
\cline{1-1}
\endfirsthead
\multicolumn{1}{l}{\hspace{9mm}\footnotesize{\slshape
 continued from previous page}\hfill{User Script avgscan.g}} \\
\cline{1-1}
\endhead
\cline{1-1}
\multicolumn{1}{r}{\small \slshape
 continued on next page} \\
\endfoot
\cline{1-1}
\endlastfoot
{\slshape\small}
\verb|#   | \\
\verb|# avgscan: function to average a series of subscans| \\
\verb|#   | \\
\verb|#   bscan:  first scan number| \\
\verb|#   escan:  last scan number| \\
\verb|#   nss:    number of subscans| \\
\verb|#| \\
\verb|avgscan := function(bscan, escan, nss=20)| \\
\verb|{| \\
\verb|    # loop through the scans| \\
\verb|    for (i in bscan:escan)| \\
\verb|    {| \\
\verb|        avg1 := [];| \\
\verb|        avg2 := [];| \\
\verb|| \\
\verb|        # IF 1| \\
\verb|        print 'Average IF 1 subscans for scan ',i;| \\
\verb|        seq1 := seq(1, nss, 2);| \\
\verb|        for (j in seq1)| \\
\verb|        {| \\
\verb|            print 'scan ', i, j;| \\
\verb|            dum := gbssa.getscan(i, j);| \\
\verb|            gbssa.plotscan(dum);| \\
\verb|| \\
\verb|             x := readline();| \\
\verb|             if (x != 'n') {avg1 := [avg1, j]} | \\
\verb|        }| \\
\verb|| \\
\verb|        # average the accepted scans and then plot| \\
\verb|        iscan := gbssa.average(i, avg1);| \\
\verb|        gbssa.plotscan(iscan);| \\
\verb|| \\
\verb|        # IF 2| \\
\verb|        print 'Average IF 2 subscans for scan ',i;| \\
\verb|        seq2 := seq1 + 1;| \\
\verb|        for (j in seq2)| \\
\verb|        {| \\
\verb|            print 'scan ', i, j;| \\
\verb|            dum := gbssa.getscan(i, j);| \\
\verb|            gbssa.plotscan(dum);| \\
\verb|| \\
\verb|             x := readline();| \\
\verb|             if (x != 'n') {avg2 := [avg2, j]} | \\
\verb|        }| \\
\verb|| \\
\verb|        # average the accepted scans and then plot| \\
\verb|        iscan := gbssa.average(i, avg2);| \\
\verb|        gbssa.plotscan(iscan);| \\
\verb|    }| \\
\verb|| \\
\verb|    return T;| \\
\verb|}| \\
\end{longtable}
