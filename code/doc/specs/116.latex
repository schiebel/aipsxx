\def\thisfile{~/aips++/nfra/nfrarequ.latex}

\documentstyle[11pt]{article}			% default is [10pt]
\setlength{\unitlength}{1mm}
\setlength{\parindent}{0mm}
\setlength{\parskip}{\medskipamount}

% LATEX_PREAMBLE_A4.TEX: Latex template 
\setlength{\topmargin}{-15mm}
\setlength{\textheight}{250mm}
\setlength{\textwidth}{140mm}
\setlength{\oddsidemargin}{0mm}
\setlength{\evensidemargin}{0mm}

% LATEX_PREAMBLE_USA.TEX: Latex template
%\setlength{\topmargin}{-1cm}
%\setlength{\textheight}{9.0in}
%\setlength{\textwidth}{6.25in}
%\setlength{\oddsidemargin}{0.15in}
%\setlength{\evensidemargin}{0.15in}
%\setlength{\marginparwidth}{0.5in}

\input epsf              % For encapsulated PostScript figures

\pagestyle{plain}        % only a page number at the foot
%\pagestyle{headings}                    

%\makeglossary           % NB: needs extra processing, see above
%\makeindex              % NB: needs extra processing, see above

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}			%%%%% start of actual document %%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\title{NFRA REQUIREMENTS FOR AIPS++\\ 
       AIPS++ User Specification Memo nr 116}
\author{J.E.Noordam}
%    10 June 1995, version 1.0}      input to Dwingeloo workshop
\date{August 1995, version 2.0}    % Submitted as AIPS++ memo
\maketitle

\hspace*{\fill} {\tiny File: \thisfile}   % show name of this LaTeX file

\vspace{0.1cm}
  \begin{center}\parbox{0.9\textwidth}{{\bf Abstract:} 
  }\end{center}

\tableofcontents 		% genarate a table of contents
%\listoffigures			% generate a list of figures
%\listoftables			% generate a list of tables
%\newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{INTRODUCTION}
\label{INTRO}

  This memo contains the NFRA requirements with respect to AIPS++.  It
is an update of User Specification Memo nr 112 {\it (Dutch
Requirements for AIPS++)}, which was an input document for AIPS++ User
Specification Memo nr 115 {\it (AIPS++ Consortium User
Specifications)} of 7 April 1992. Although the essence of the
requirements has not changed significantly, an update was deemed useful
in the light of the developments in the AIPS++ project since 1992. 

Version 1.0 of this document was discussed with the potential Dutch
AIPS++ user community at a workshop in Dwingeloo, on 14 June 1995, and
with the AIPS++ Project Manager. It was then updated with the received
comments and suggestions, clarified where necessary, and submitted
as an AIPS++ User Specification Memo. 



%==========================================================================
\subsection{NFRA policy towards AIPS++}
\label{INTRO-policy}

The NFRA policy towards AIPS++ has the following main pillars: 

\begin{enumerate}
  \item {\bf A strong AIPS++ Consortium:} This represents a vital
interest of NFRA, which needs the new package and cannot write (and
maintain, and export) it by itself. NFRA also needs to widen the WSRT
customer base by tying into the `world reduction package'.  The Joint
Institute for VLBI in Europe (JIVE), which is associated to NFRA, has
similar needs.
  \item {\bf A strong AIPS++ Centre:} The Project must succeed. This
requires the concentration of a very strong central team, especially
in the next 1-2 years.  Buzz-words: Management.  Responsibility.
Design.  Infrastructure.  Coordination.  Integration.  Operations.
Software Engineering.
  \item {\bf An active AIPS++ group in the Netherlands:} NFRA can only
defend its own interests, and thus control its own destiny, if it is
capable of making significant contributions.  An important by-product
of at least one active outside group is to keep the Centre aware of
its role to support other AIPS++ development groups.  Buzz-words are:
Programmability, Cultural differences.
  \end{enumerate}

NFRA has always played a very active role in the Consortium (and has
probably kept it alive by doing so). It has made the largest
contribution to the Centre after NRAO (Van Diepen, Olnon, the `UVCI
efforts' in Dwingeloo in 1994/95, development of the matrix-based
Measurement Equation), and intends to continue to do this.  NFRA has
also earmarked some extra funds (about 200 kfl over 2 years) to
stimulate the project at key points when necessary. Part of this money
has already been used to strengthen the new Socorro Team by helping
ATNF to send Mark Wieringa there, and to make it possible to bring
forward the hiring of a new programmer.

The local AIPS++ group in Dwingeloo is now preparing to follow close
on the heels of the AIPS++ Centre in Socorro. The group will
concentrate on uv-calibration and imaging (UVCI), with emphasis on the
special NFRA interests listed in section \ref{INTRO-interests} below.
The group will work within the framework of the overall AIPS++ project
as much as possible, according to the priorities set by the AIPS++
Project Manager, unless urgent local concerns dictate otherwise.

%==========================================================================
\subsection{NFRA special interests}
\label{INTRO-interests}

The interests of NFRA are {\it parallel but not identical} to those of
other Consortium members. In particular, NFRA seems to be the only
member that has expressed the wish to change over from its current
WSRT uv-data reduction package (NEWSTAR) to AIPS++ as soon as possible
(starting in 1996), because it cannot afford to work on two packages
at the same time.  This has prompted NFRA to insist that the
implementation of `everyday' calibration by the Centre should get a
higher priority than was originally planned. Moreover, there are some
specific areas, usually connected to WSRT, EVN and Square Km Array
(SKAI), to which NFRA attaches particular importance. The following list
is not in any specific order:

\begin{itemize}
  \item {\bf Polarisation:} A WSRT niche. This includes the
ionosphere, off-axis instrumental effects, and high-accuracy
calibration procedures.
  \item {\bf A capable Sky Model:} Parametrised Source
Components. Proper treatment of CLEAN Components. Knowledge of own
limitations (sensitivity window, resolution)?
  \item {\bf VLBI:} EVN and World Array, including Space. Tied array
performance (closure errors). Polarisation. Phase referencing.
Cluster-cluster VLBI.
  \item {\bf Low-frequency mapping:} A WSRT and SKAI (and GMRT)
niche. Crowded fields. Flux that is a significant fraction of
Tsys. Non-isoplanaticity. Scintillation. Refraction. Chromatic sky
effects that are inherent with a wide fractional bandwidth.
  \item {\bf Wide-field mapping:} In particular the early
implementation of joint deconvolution of mosaiced
fields. Coordinates.
  \item {\bf Filtering of uv-data:} Continuum subtraction. EM
interference. Strong sources outside the field (Sun, CasA).
  \item {\bf Unusual telescope modes:} To make maximum use of the
specific qualities of the WSRT, and fill up the holes in the schedule.
Tied array. Sub-arrays. Combination with other telescopes. Wide field
mapping. This lays emphasis on the {\it generality} of the way AIPS++
is set up.
  \item {\bf Instrumental set-up:} AIPS++ functions to measure
instrumental parameters must be `callable' by the new WSRT
Telescope Management System (TMS).  See appendix \ref{TMS}.
  \item {\bf Redundant baseline calibration:} An important extra check
on the quality of the calibration. 
  \item {\bf Square Km Array:} See appendix \ref{SKAI}.
  \end{itemize}



%==========================================================================
\subsection{NFRA time-scales}
\label{INTRO-time}


NFRA would like to start changing over from its current data reduction
package (NEWSTAR) to AIPS++ during 1996. This time-scale is driven
particularly by the needs of the new WSRT Telescope Management System
(TMS), and other aspects of the WSRT upgrade.

\vspace{-0.8cm}					% reduce vertical gap
\begin{tabbing}
++\=+++++++\=+++++++++++++++++++++\= \kill 
\+						% Start at 1st tab
~\\ Jan 1996   \>Decision whether to use NEWSTAR intermediately for TMS  
~\\ Aug 1996   \>First production release of TMS  
~\\ Aug 1996   \>Prototype of new WSRT backend arrives (TMS needed)   
~\\ Sep 1996   \>New WSRT frontends arrive (TMS needed)   
~\\ Jan 1997   \>Start of simulations for the Square Km Array (SKAI)  
~\\ Jul 1997   \>Final possibility for TMS to adopt AIPS++  
~\\ Nov 1997   \>Second production release of TMS    
~\\ Jan 1998   \>WSRT WENSS survey finished: NEWSTAR pensioned off.  
~\\ Apr 1998   \>Final production release of TMS    
~\\ Dec 1999   \>WSRT WHISP survey finished.  
~\\ 1999       \>Choice of SKAI concept  
~\\ 2005       \>Integration of SKAI prototype element(s) in WSRT  
~\\ 2010       \>SKAI fully operational  
\end{tabbing}
\vspace{-0.4cm}					% reduce vertical gap


The basic assumption is that the Centre will indulge in an intensive
UVCI design acitivity during the remainder of 1995, and produce a
complete UVCI system for the ATCA in the beginning of 1996.  The NFRA
AIPS++ group will then add WSRT-specific features where necessary,
while becoming AIPS++ application programmers in the process.  After
that, the group will be in a position to contribute new functionality.

In the meantime, it is assumed that the AIPS++ infrastructure will
develop in step with the applications, and that the interests of other
Consortium members will drive the development of other (non-UVCI)
AIPS++ functionality like Image Analysis.

It is {\bf highly desirable} for NFRA to be able to use AIPS++ for the
TMS for its first production release in August 1996: the fall-back
option of using NEWSTAR for 1-2 years is certainly possible, but
time-consuming and confusing. A definite decision about this will be
taken in January 1996.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{GENERAL REQUIREMENTS}
\label{GEN}

The following General Requirements are either fundamental, or not easy
to place in a specific category. They are not necessarily in order of
importance:

{\bf Explicit design:} Long overdue. Essential for a proper management
of the project. The absence of an explicit design has made it very
difficult for anyone but the `inner circle' to contribute to AIPS++:
the potentially large pool of person-power is used ineffectively. The
reliance on an implicit design has also increased the danger of
`single-point failures'.

{\bf TMS interface:} An interface (software bus) that allows other
systems like the WSRT TMS to use AIPS++ functions, and that allows
AIPS++ to communicate with external packages.

{\bf Version management:} The TMS will rely on certain AIPS++
functionality for its critical on-line operations. It will therefore
only adopt a new AIPS++ release after a period of extensive
testing the TMS-critical bits. This means that the TMS (and perhaps
other on-line systems?) may work with `frozen' versions of AIPS++ at
times.

{\bf HP9000 platform:} Most NFRA (and JIVE) workstations are of this
make (although the local AIPS++ group has a SunSparc20 for
development). AIPS++ should be `ported' to HP's by the time of the
first release in early 1996.

{\bf Programmers support:} Documentation. Examples. Template
applications.  Graphical tools to pipeline AIPS++ modules. Schools?

{\bf User support:} Documentation. Quality control. User feedback. 

{\bf Global Services} like Time and Earth motion should be provided
centrally by AIPS++. This includes collection of data from Bureaus of
Standards etc by the Centre. {\it NB: A similar software structure is
needed to deal with local ionospheric data (see section
\ref{MM-farad}).  It would be a nice example of code reuse if
elements of the software structure that deals with global Time could
be copied for that purpose.}

{\bf Future tiger teams:} One of the potential advantages of AIPS++ is
expected to be that isolated experts scattered around the globe will
be able to collaborate more effectively in tackling difficult
problems.  Once AIPS++ is operational (in 1996/7), international
`tiger teams' should be set up to study subjects like Map Reliability,
interference detection and rejection, or refinement of the Measurement
Equation.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{GENERALITY OF DESIGN}
\label{GENDES}

While it is true that too much generality causes delays and may lead
to an unworkable result, it is also true that unfortunate design
decisions in existing packages have sometimes made the implementation
of new functionality unnecesarily difficult and ugly. (I deliberately
refrain from giving examples, but we can all think of some good ones).
The design of AIPS++ should not {\it exclude} any of the known
observing, calibration and imaging modes, and somehow create a `better
than usual' environment for the natural inclusion of new ones. The
following principles could be adopted:


  \begin{description}
  \item[Principle 1] 
  AIPS++ should be {\it driven by an explicit Measurement Equation
(ME)}.  This means the properties of different instruments, and all
simplifying assumptions, must be specified explicitly by means of the
ME.  They must {\em not} be programmed into the code of solvers etc.
A modification or refinement of the ME should not require modification
of the code of solvers etc. For an example of a suitable ME, which
seems to descibe most Consortium telescopes in a generic way, see the
matrix-based ME developed by Bregman, Hamaker and Sault
\cite{Hamaker95}, \cite{Noordam95}.


  \item[Principle 2] 
  All observing modes should be fully {\it parametrised}, without any
hidden assumptions. In particular:
    \begin{itemize}
    \item A continuum observation should be regarded as a line
observation with only one channel.
    \item An observation of a single field should be regarded as a
mosaic with only one pointing centre.
    \item An array can be split into any number of completely
independent sub-array's (including tied arrays!) of any size, which
may be looking in different directions with different instrumental
sessions.  {\it NB: Leonid Gurvits will state the precise requirements
for `cluster-cluster VLBI' before the end of 1995.}
    \item There should be no fundamental difference between the
treatment of arrays's and single dish telescopes (including tied
arrays).
    \item It should be straightforward for the user to combine data
from any (radio) telescope into a single map, and to calibrate them
together using a single Sky Model.
    \item Physical parameters like dipole angles should be given
explicitly, and not hidden in some kind of `polarisation code'.
    \item It should not be assumed that the antenna's are tracking the
sky, or that pointing centre, fringe-stopping centre and delay centre
coincide.
    \item Great care should be excersised in building in assumptions
about width and step parameters for frequency channels, integration
time, mosaicing grid etc.
    \item Any more...?
    \end{itemize}

  \item[Principle 3] Religious attention should be devoted to {\it
consistency}, both in the definition of terms and subsequent adherence
to them (however tiresome this may sometimes be, especially in the
beginning).  The following areas spring to mind, but there are
undoubtedly others:
    \begin{itemize}
    \item Nomenclature. Example: With an eye on convergence between
the treatment of synthesis telescopes and single-dish telescopes, and
looking ahead to the possibility of focal-plane arrays, we have agreed
after considerable debate that a {\it telescope} has one or more {\it
antennas}, each of which has one or more {\it feeds}, each of which
has one or two {\it receptors}, while the data comes out of {\it
IF-channels}. However, this convention is constantly (allowed to be)
flouted.
    \item MS columns should always be consistent with each other.  If
that causes problems because of local custom for some Consortium
telescopes, local custom is clearly wrong.
    \item Global constants and derived constants should be centrally
defined.
    \item Etc...
    \end{itemize}

  \end{description}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{SIMULATION}
\label{SIMUL}

Simulation of corrupted uv-data is extremely important for testing the
correctness of calibration procedures etc. It should be available at
the very beginning, and not be an after-thought, like in most existing
packages.  In a somewhat later stage, simulation will also be an
important tool in the study of the {\it limitations} of calibration
and imaging. And finally, simulation is an important tool in the
development of new instruments like the Square Km Array.

The following {\it extra} functionality is all that is needed:

{\bf Tools for specification:} The user has to be able to specify Sky
Models, Measurement Equations, and the actual values of all kinds of
instrumental effects, in uv-plane and image-plane.

{\bf Tools for assessing the results:} Convenient visualisation and
quantification of the difference between simulated input and the
resulting output.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{UV-DATA MANIPULATIONS}
\label{UVDAT}

%===========================================================================
\subsection{Format conversions}
\label{UVDAT-format}

{\bf MS-filler from WSRT archive data:} Needed soon. The route via
NEWSTAR and UVFITS is cumbersome and possibly restrictive, and will   
eventually disappear. NFRA (FMO) will split the design into a part
that is generic, and can be used for other telescopes, and a part that
is WSRT-specific.

{\bf Reading corrections from NEWSTAR SCN-files:} May be needed while
some NEWSTAR calibration functions are not yet in AIPS++. One way of
dealing with this is to transfer corrected data from NEWSTAR to AIPS++
via UVFITS. If that proves impractical for some reason, it may be
desirable to transfer NEWSTAR corrections to AIPS++, which requires
much less work than transferring uv-data. The latter can always be
read from the WSRT archive format.


%===========================================================================
\subsection{Editing and Filtering}
\label{UVDAT-Edifil}

{\bf Editing} means removing unwanted uv-data, for whatever reason.
This can be done by separating selected data into a secondary MS, or
by setting (reversible) flags. Editing is usually done interactively,
for instance by pointing to the screen, and can be very
time-consuming.  An alternative way to identify `bad' data is by
filtering (see below).

{\bf Filtering} means applying some kind of software filter to the
data, with the object of flagging or subtracting unwanted parts.
Examples are the subtraction of continuum flux from line data,
removing interference, or removing the effects of a strong source
outside the primary beam (like the Sun or CasA).  In view of the
increasing data volume, and the rising level of interference,
filtering will be of increasing importance. The development of
sophisticated and reliable algorithms should get a high priority.

{\small Implementation suggestion: For multi-dimensional filtering
operations it might be efficient and/or convenient to transfer the
uv-data temporarily from the MS to a 3D cube, with axes time,
frequency channel, and interferometer nr. The user defines the
dimensions of the cube, which might represent a subset of the data, or
a sliding time window. Such `fit-cubes' might be implemented as a
separate class, with generalised filter functions as methods.}

NEWSTAR has 8 flags per uv-data value, so that they can be flagged for
different reasons. This makes it possible to undo the result of some
flagging operations, without having to reset {\it all} flags (which
may represent many hours of work).

After uv-data has been filtered, it will often be desirable to collect
the subtracted part into a {\bf secondary Measurement Set}, for
instance to make a separate map to check whether anything valuable has
been thrown away by the filtering proces. Another reason for the use
of secondary MS's is `data-decimation' for quick-look purposes,
possibly after smoothing. In short, there are many reasons to
integrate the concept of secondary MS's as receptacles for subsets
of {\it physically modified} uv-data into AIPS++ in a natural fashion.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{SOLVERS FOR INSTRUMENTAL (MM) PARAMETERS}
\label{MM}

In the latest thinking, the {\bf Measurement Model} enshrines all the
information about the instrument, in the form of a Measurement
Equation and actual values for its parameters. (This differs from the
original Green Bank Model). A {\bf Solver} estimates (better) values
for instrumental parameters. In this section, a list is given of the
instrumental effects for which NFRA requires Solvers.

{\bf Manual input:} Sometimes the user already has an alternative
source for parameter values, for instance data about the
inonosphere. In that case, there must be tools to use these
data.

{\bf Using redundant spacings} is important for calibration.
Traditionally, spacings are defined as redundant when they occupy the
same cell in uv-space, which is usually also a function of
polarisation, frequency, and time. Redundancy is `stronger' if the
cell is smaller.  The concept can be generalised to stating that
visibilities are redundant if a {\it nominal} Measurement Equation
(defined by the user) produces the same values for them for a
user-defined {\it trial} Sky Model, to an accuracy specified by the
user.  Redundancy equations represent a `higher truth' than Selfcal
equations because they do not depend upon a {\it detailed} Sky Model,
which may be incomplete.  Therefore, Solvers must be equipped with the
extra book-keeping capability to make use of redundant spacings.



%============================================================================
\subsection{Complex Gain (G-matrix)}
\label{MM-gain}

{\bf IF-based,} i.e for each IF-channel either amplitude and phase, or
a complex number.

{\bf Phase screen over the array:} This can be treated as a
parametrised expression that links the individual phases for each IF.

{\bf X/Y Phase-Zero Difference (PZD):} Tricky and important, because
it will translate Stokes U into Stokes V (for the WSRT). For very high
accuracy measurements of V, the PZD has to be calibrated to a degree.
There are various ways to estimate it:
  ~\\ - Standard WSRT procedure: An unpolarised point source is
observed with `crossed' dipoles. {\it This will no longer be possible
with the new frontends.}
  ~\\ - Standard NEWSTAR procedure: first correct for leakage,
using an unpolarised source, then look at a source with strong
U-polarisation.
  ~\\ - Mosaicing: create artificial U, by moving the
telescope so that a strong source is in the U-lobe of the off-axis
instrumental polarisation. The great advantage is that this method can
be used on an arbitrary source, during the observations.
  ~\\ - Minimise the V-polarisation of the short baselines
when observing very extended sources like large-scale galactic
foreground. Works very well, but only for special cases.
  ~\\ - Inject a noise signal simultaneously into X and Y
channels. Experience at the ATCA indicates that the overall PZD can be
kept to a few degrees, even though the dipoles and the atmosphere are
excluded. The new WSRT frontends will have this capability too. 

{\bf IF Delay offsets:} They cause phase gradients across the
frequency bands, and thus cause decorrelation. They cannot be properly
corrected afterwards, so they have to be set right before the
observation. {\it NB: Delay offsets seem to play a role also in the
relatively high closure errors (decorrelation!) that the WSRT tied
array causes in VLBI.}

{\bf IF bandpass shape:} Phase and amplitude.

{\bf Undoing Tsys:} This is a correction that has been physically
applied on-line at the WSRT. It is not entirely correct for certain
fields with lots of 90cm flux in the galactic plane. It must be
possible to undo the on-line correction, and replace it with a new
one.

{\bf Antenna positions:} These are measured by looking at the
time-behaviour of Selfcal phase of a strong calibrator. For greater
accuracy, multiple calibrators in different parts of the sky are
used. 

%============================================================================
\subsection{Dipole Leakage (D-matrix)}
\label{MM-leak}

Should probably be solved semi-simultaneously (i.e. alternating
iteratively) with the G-matrix.  For linearly polarised receptors, the
real part of the leakage terms is to first order a dipole position
angle error. Therefore, it is important to account for Faraday
rotation at the same time.

%============================================================================
\subsection{Primary Beam (B-matrix)}
\label{MM-beam}

{\bf Beamshape/Off-axis polarisation:} Measured by stepping through a
grid of pointing positioins around a strong calibrator source with
known polarisation. If a satisfactory analytical expression can be
found, one may solve for its parameters. Otherwise, the results must
be smoothed by a suitable function to reduce the measurement noise,
and stored in an `lmf-cube' (position(l,m) and frequency(f)). {\it NFRA
will start measuring them this fall, using NEWSTAR.}

{\bf Pointing errors:} Time-dependent, different per antenna. A
procedure is needed in AIPS++ to replace the existing program for
measuring the WSRT pointing model. {\it TMS requirement.}

{\bf Mirror surface:} Holography. Measuring strategy: One reference
antenna is pointed at a strong source, while another steps through a
grid of pointing positions around it. The output is Fourier
Transformed to give the deviations of the antenna mirror surface.
This strategy can also be used to detremine the beam-shape.

{\bf Non-isoplanaticity:} Time-dependent, different per antenna. May
be important for the SKAI (and GMRT), and in some cases for the WSRT.
{\it It has been suggested that this effect should be modelled by a
(relatively thin) phase screen at an altitude of several km above the
telescope.  Alternatively, one might tackle it via time-dependent
position parameters for the Sky Model components.}


%============================================================================
\subsection{Faraday Rotation (F-matrix)}
\label{MM-farad}

Correction for Faraday rotation is vital for the NFRA search for
linearly polarised sources at 90/50 cm (WENSS), which are candidates
for msec pulsars. The ionospheric Faraday rotation can vary up to 15
degr per hour at these frequencies, especially in the daytime. This
can completely `wash out' the linear polarisation in a 12-hr
observation.

{\bf External:} Estimates of the Faraday rotation can be derived to a
certain extent from external measurements of the ionosphere (ionosonde,
chirpsounder, GPS). Especially 2-frequency GPS is promising, because
it measures the effect {\it through} the ionosphere. All methods
measure the Total Electron Content (TEC) of the ionosphere. They all
require a model of the TEC distribution to estimate the actual Faraday
rotation along the direction of the observed source.   

{\bf Faraday Selfcal:} Determines the Faraday rotation {\it
variations} with the help of a strong polarised source during the
observations. In general, the angle separation with the target source
will be so large ($>$ 1 degr) that an ionospheric TEC model will be
needed to calculate the Faraday rotation for the target source.
 

{\bf What is needed}: 
  ~\\ - a local mechanism to store and retrieve the ionosphere data as
a function of time.
  ~\\ - an AIPS++ mechanism to plug in and use TEC models to calculate
the Faraday rotation in a certain direction at a certain time.

{\it NB: If a way could be found to make a map of the total amount of
linear polarisation by Fourier Transforming
$P_{vis}~=~\sqrt{Q^{2}_{vis}+U^{2}_{vis}}$, all this Faraday stuff
would be less urgent. See also `exotic maps' in section \ref{IMAG}.}

%============================================================================
\subsection{Interferometer-based effects (M and A matrices)}
\label{MM-ifr}

{\bf Additive (A-matrix):} The increasingly popular WSRT 327 MHz
broadband (80 MHz) system has additive ifr-based errors, which show up
as constant non-zero values in the selfcal residuals (at least when
the dominating source is a point source in the centre of the
field). Until they are understood, they must be removed in software.

{\bf Multiplicative (M-matrix):} ...

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{SKY MODEL (SM)}
\label{SM}

In the most recent thinking, a {\bf Sky Model} (SM) is the projection
on the sky of a 3D astrophysical {\bf Source Model} (SOMOD?). The
latter is not foreseen in the early AIPS++, and will not be discussed
further here. 

A Sky Model must be instrument-independent by definition. Otherwise it
cannot be used to combine the data from observations with different
instrumental settings (e.g. mosaicing), or even from entirely different
instruments. But a Sky Model should perhaps know about its general
limitations, i.e. the parts of Phase Space about which it has no
information.

NFRA has always championed an `able' Sky Model like the one used in
NEWSTAR and VLBI. The NEWSTAR Sky Model contains a mixture of (fully
deconvolved) Parametrised Source Components (PSC) and traditional
CLEAN Components (CC).  The parameters of PSCs are: Flux (I,Q,U,V),
position (l,m, not tied to a grid), shape (elliptic gaussian only),
Faraday rotation measure, spectral index.  In AIPS++, one could add
other spectral parameters, and time-dependence of all parameters.
{\it NB: Braun has suggested that it might be possible to model some
sources of EM interference as a special kind of Sky Model component.}

Since the Measurement Equation (ME) of a radio telescope does not have
a proper inverse, the {\it best} way to generate and improve a Sky
Model is by fiddling its parameters (and the parameters of the
Measurement Model) until the predicted uv-model is consistent with the
measured uv-data. This will require {\bf solvers} of the same type as
those for instrumental parameters.
 
The problem with CCs is that they are only partially deconvolved: a
point source will be represented by a collection of CCs at
neighbouring grid-points. Also, the effects of bandwidth smearing etc
will cause a point source to be interpreted as an extended source. For
the Sky Model to be truly instrument-independent, CCs have to be
converted into PSCs by means of some kind of `residual deconvolution'
before the Sky Model can be `updated'.

One way to make a {\it polarised} Sky Model is to CLEAN all four
I,Q,U,V maps simultaneoulsy, convert the CCs into PSCs, and fiddle
them further using the actual uv-data.

It is clear that the thinking about Sky Models is still immature
within the Consortium. Ideas and experience will have to be pulled
together into an integrated set of concepts. This should be a high
priority, before too many of the old concepts get entrenched in
prototypes etc.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{IMAGING ISSUES}
\label{IMAG}

{\bf East-West arrays} have advantages for wide-field mapping,
especially at low frequencies (300 MHz), because they can handle their
geometry exactly.

{\bf Robust weighting}, as developed by Briggs \cite{..},
automatically finds the optimum on a sliding scale between `uniform'
and `natural' weighting, depending on the available uv-data.  This
might be the answer to the problem of adding all the redundant WSRT
spacings into a map while retaining the low sidelobe level of the
regular WSRT beamshape is retained. Such a weighting scheme is needed
in any case to combine the data from an arbitrary collection of
telescopes into a single map.

{\bf Polarisation calibration using mosaicing:} Bregman has suggested
that one might use the (known) off-axis instrumental polarisation to
calibrate other polarisation parameters during the observation of an
arbitrary source. Especially the X/Y Phase Zero Difference, using the
artificial Stokes U. This strengthens the requirement in section
\ref{GENDES} that mosaicing should be the {\it default} mode of
observing.

{\bf Tied Array:} Apart from their use for VLBI, tied arrays can also
be formed into local interferometers. For instance by splitting the
WSRT array into two or more tied arrays of one or more antennas each,
whose outputs are then correlated. The purpose is to get high
sensitivity and a very long spectrum (16.000 channels). This mode
requires modelling and subtraction of background sources. The
residuals are processed with single-dish type software.


{\bf Exotic maps:} Example: A map of $P^2_{vis}=Q^2_{vis}+U^2_{vis}$,
to detect sources with high linear polarisation, without worrying
about Faraday rotation. Since the FT of a square is an
autocorrellation, this will cause a very high noise peak in the centre
of the map. Pogrebenko has suggested that this can be avoided by
taking $P^2(t)=Q(t).Q(t+\Delta t)+U(t).U(t+\Delta t)$,
i.e. multiplying the corresponding uv-data of successive integration
intervals.

{\bf Drift-Scanning:} The antenna's do not track the sky, but the
fringe-stopping does. This is a form of mosaicing in which the
mechanical gears are not worn out so quickly, and no observing time is
lost by changing the pointing centre. It may be a can of worms, but the
possibility should be considered.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{IMAGE ANALYSIS}
\label{IMAL}

NFRA places a high importance to this, but assumes that the
requirements of other Consortium partners will drive the development
of Image Analysis (not to be confused with Visualisation!). No
specific needs were identified at the AIPS++ workshop in Dwingeloo on
14 June 1995. The Groningen group will rely on GIPSY for the immediate
future, and is not contemplating any direct involvement in AIPS++ in
1995/6.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{USER INTERFACE}
\label{UI}


%=============================================================================
\subsection{Command Line Interface (CLI)}
\label{UI-CLI}

Assumed to be Glish for the time being. Must be consistent, complete,
self-evident, and able to manipulate AIPS++ objects. 

%=============================================================================
\subsection{Information manipulation}
\label{UI-man}

Walter Jaffe has emphasised that packages like AIPS and IRAF could be
described as `schedulers of large operations'. These packages have few
facilities for the intuitive manipulation of (small) chunks of
data. These two modes should be reconciled in AIPS++.  {\it NB: This
should remove an important psychological obstacle in the unification
of synthesis and single dish observing.}

%=============================================================================
\subsection{Visualisation}
\label{UI-VISU}

Jay Chengalur has submitted a list of requirements to Dick Crutcher,
who answered that all of them will be met in the next version of
AipsView. Other people can check it out for themselves by signing up
as AipsView "beta tester" {\it (Email: aipsview@ncsa.uiuc.edu)}.

We need powerful, efficient and convenient visualisation of at least
images and uv-data. 3D visualisation should be available on common
machines.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\appendix
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{APPENDIX: WSRT TELESCOPE MANAGEMENT SYSTEM}
\label{TMS}

The needs of the TMS are a prime driver for the NFRA requirements for
AIPS++ in terms of timescale. {\it In this sense, the TMS plays the
same role for NFRA as the GBT does for NRAO}. The first production
version of the TMS has to be operational in August 1996, and it would
be highly desirable if it could use AIPS++ from the start. The
alternative of using NEWSTAR as an interim solution is viable but
unattractive. Therefore, a separate checklist is given here for the
minimum required TMS functionality. If the prospects for the items on
this list look good in January 1996, the TMS project team will be able
to lean on AIPS++ from the start. For a more detailed treatment of TMS
needs, see \cite{DeVos95}.

  \begin{itemize}
  \item {\bf HP9000:} AIPS++ must run on that kind of machine.
  \item {\bf Program control:} of AIPS++ programs from TMS (via Glish).
  \item {\bf Reading uv-data into AIPS++:} If necessary via the
WSRT archive format, but preferably directly from the TMS output
format. {\it NB: It should be possible to let an AIPS++ storage
manager fill the colums of a Measurement Set directly from the TMS
output data and from the TMS data-base.}
  \item {\bf Sky Model :} with Parametrised Source Components. At
first only for introducing {\it existing} NEWSTAR calibrator models,
for calibration. 
  \item {\bf Calibration :} Solvers for instrumental parameters, at
the very least complex gain and dipole errors. Tools to apply the
estimated corrections to the uv-data.{\it NB: It is assumed that, if
AIPS++ is driven by a Measurement Equation, the solvers for other
instrumental parameters are a trivial addition.}
  \item {\bf Source subtraction :} From the uv-data, using the Sky
Model.
  \item {\bf  Making an image:} All the usual options in terms of tapers
and polarisation etc.
  \item {\bf Visualisation:} Of uv-data and images. Also 1D graphics. 
  \item {\bf Data statistics:} Averages, rms etc.
  \item {\bf Data editing :}, manually only for the moment. 
  \end{itemize}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{APPENDIX: SQUARE KM ARRAY (SKAI)}
\label{SKAI}

The SKAI has officially been launched as the next large project of
NFRA. It consists of a radio telescope with a total collecting area of
one square km, distributed over an array of 30-100 elements, each with
a diameter of 100-200 m. Most elements will be within an ellipse of
30-50 km, but a few `outriggers' will be up to 200 km away. Wavelength
coverage is 150-1500 MHz. The current plan is to select the concept in
1999, build 1-3 prototype elements and integrate them with the WSRT
before 2005, and build the entire instrument before 2010.

We assume that AIPS++ will be flexible enough to grow in response to
new developments for 15-20 years (!), so that it will still be around
when the SKAI comes on-line. But in any case, AIPS++ will be needed
for {\bf simulations} during the development phase, starting in 1997.

If the SKAI elements would be conventional parabolic dishes, it would
have the same processing requirements as the GMRT (except for multiple
simultaneous beams).  However, it seems more likely that the
indivudual elements will be some form of phased dipole array,
preferably without moving parts. Such an element may have
unconventional properties:

  \begin{itemize}
  \item {\bf Primary Beam:} The shape will vary as a function of
zenith-angle, and as a function of azimuth if the antenna is not
round. The beamshape could be controlled electrically, to `null out'
known sources of interference.

  \item {\bf Multiple beams:} There may be upt to 10 independent
beams, which may overlap on the sky. 

  \item {\bf Polarisation:} The two perpendicular sets of fixed
dipoles in a horizontal dipole array are no longer perpendicular when
viewed from the source.

  \item {\bf Tied array with many elements:} A dipole array could have
as much as $10^5-10^6$ dipoles. 
  \end{itemize}

Moreover, prototypes of these unusual antennas have to be integrated
in the WSRT. Fortunately, all this will not present a problem as long
as SKAI antennas meet the requirement that can be fully described by
means of an antenna-based `Jones' matrix in the Measurement Equation.
This is the case for all concepts that have been considered to date.
So, {\i as long as AIPS++ is driven by a Measurement Equation}, it
will be able to meet the requirements of the SKAI with virtually no
extra effort (amazing, isn't it?)

Finally, since the correlator will have at least one million channels,
the data volume will be huge. Distributed and Parallel Processing will
be required.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{thebibliography}{123456789}      % {123..} is widest entry label
\bf                                     % use boldface (except \it)

  \bibitem{Hamaker95} J.P.Hamaker, J.D.Bregman, R.J. Sault: {\it
Understanding Radio Polarimetry I: Mathematical foundations.}
Submitted to Astronomy and Astrophysics, July 1995.

  \bibitem{Noordam95} J.E.Noordam: {\it Some practical aspects of the
matrix-based Measurement Equation of a generic radio telescope.}
AIPS++ Implementation Note nr 182.

  \bibitem{DeVos95} C.M. de Vos: {\it Relation between WSRT Telescope
Management System (TMS) and AIPS++. The AIPS++ Functionality expected
by the TMS.  } TMS Memo NFRA/TMS/Memo/21, 15 June 1995

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\end{thebibliography}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\end{document}
 
